# z_calibration config (Klicky + switch endstop)
# Tune switch_offset via RUN_CALCULATE_SWITCH_OFFSET.
[z_calibration]
nozzle_xy_position: 230,343
switch_xy_position: 237,327
wiggle_xy_offsets: 0,0
switch_offset: 3.999 # Had to tweak this a lot
offset_margins: -2.0,-1.0 # Same here
speed: 50
probing_first_fast: false
start_gcode: Attach_Probe
end_gcode: Dock_Probe

[gcode_macro RUN_CALCULATE_SWITCH_OFFSET]
description: Walk-through to compute switch_offset for z_calibration
gcode:
  # Run hot, clean nozzle. Follow the pause prompt and update switch_offset
  # with the value reported in the console.
  CALCULATE_SWITCH_OFFSET

[gcode_macro DEBUG_ZCAL_STATE]
description: Print z_calibration and probe state for troubleshooting
gcode:
  {action_respond_info("homed_axes=%s" % printer.toolhead.homed_axes)}
  {action_respond_info("gcode_position=%s" % (printer.gcode_move.gcode_position|string))}
  {action_respond_info("probe.z_offset=%s" % printer.probe.z_offset)}
  {action_respond_info("cfg.probe.z_offset=%s" % (printer.configfile.settings['probe'].z_offset|string))}
  {action_respond_info("probe.last_query=%s" % printer.probe.last_query)}
  {action_respond_info("z_cal nozzle_xy=%s switch_xy=%s" %
    (printer.configfile.settings['z_calibration'].nozzle_xy_position|string,
     printer.configfile.settings['z_calibration'].switch_xy_position|string))}
